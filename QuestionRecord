1.ä¸ºä»€ä¹ˆåœ¨request_vote.goç¬¬18è¡Œä¼šå‡ºç°reply.Term > args.Termçš„æƒ…å†µï¼Œå› ä¸ºåœ¨leaderElectionä¸­æˆ‘ä»¬åˆšåˆšå¢åŠ äº†currentTermå¹¶å°†å…¶è®¾ç½®åˆ°argsä¸­ï¼Œç„¶åæ‰å‘èµ·goroutineã€‚

  è®©æˆ‘è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µï¼š

  å¯èƒ½çš„åŸå› ï¼š

  1. å¹¶å‘é€‰ä¸¾ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¯èƒ½æœ‰å¤šä¸ªèŠ‚ç‚¹åŒæ—¶å‘èµ·é€‰ä¸¾ã€‚å‡è®¾æœ‰èŠ‚ç‚¹Aå’ŒBéƒ½åœ¨term
  Næ—¶å‘èµ·é€‰ä¸¾ï¼Œå®ƒä»¬éƒ½æŠŠè‡ªå·±çš„termè®¾ç½®ä¸ºN+1ã€‚ä½†æ˜¯åœ¨ç­‰å¾…å›å¤çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½æœ‰ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹Cåœ¨term N+2æ—¶æˆä¸ºäº†leaderï¼Œé‚£ä¹ˆCçš„termå°±æ¯”A/Bçš„args.Termæ›´å¤§ã€‚
  2. ç½‘ç»œå»¶è¿Ÿå’Œæ—¶åºï¼šè™½ç„¶æˆ‘ä»¬åœ¨ç¬¬30-35è¡Œè®¾ç½®äº†args.Term =
  termï¼ˆç­‰äºrf.currentTermï¼‰ï¼Œä½†æ˜¯åœ¨ç¬¬40è¡Œå‘èµ·goroutineæ—¶ï¼Œå…¶ä»–èŠ‚ç‚¹å¯èƒ½å·²ç»æœ‰äº†æ›´é«˜çš„termã€‚å½“candidateRequestVoteæ”¶åˆ°å›å¤æ—¶ï¼Œé‚£ä¸ªèŠ‚ç‚¹çš„termå¯èƒ½å·²ç»æ›´æ–°åˆ°äº†æ›´é«˜çš„å€¼ã€‚
  3. çŠ¶æ€è½¬æ¢ï¼šåœ¨é€‰ä¸¾è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹å¯èƒ½ï¼š
    - å…ˆè¿›å…¥candidateçŠ¶æ€ï¼Œterm+1
    - å‘é€æŠ•ç¥¨è¯·æ±‚
    - åœ¨ç­‰å¾…å›å¤æ—¶æ”¶åˆ°æ›´é«˜termçš„leaderçš„å¿ƒè·³
    - ç„¶åéœ€è¦è½¬æ¢ä¸ºfollowerå¹¶æ›´æ–°åˆ°æ›´é«˜çš„term

  å…·ä½“åœºæ™¯ç¤ºä¾‹ï¼š
  - èŠ‚ç‚¹Aåœ¨term 5æ—¶å‘èµ·é€‰ä¸¾ï¼Œè®¾ç½®args.Term = 6
  - ä½†åœ¨å®ƒç­‰å¾…å›å¤æ—¶ï¼ŒèŠ‚ç‚¹Båœ¨term 7æ—¶æˆåŠŸå½“é€‰ä¸ºleader
  - å½“Aæ”¶åˆ°Bçš„å›å¤æ—¶ï¼Œreply.Termå°±æ˜¯7ï¼Œè€Œargs.Termè¿˜æ˜¯6
  - æ‰€ä»¥reply.Term > args.Termæˆç«‹ï¼ŒAéœ€è¦æ›´æ–°åˆ°term 7å¹¶åœæ­¢é€‰ä¸¾

  è¿™å°±æ˜¯ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªæ£€æŸ¥æ¥ç¡®ä¿Raftç®—æ³•çš„æ­£ç¡®æ€§ï¼Œé˜²æ­¢å¤šä¸ªleaderåŒæ—¶å­˜åœ¨

  2.ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªæƒ…å†µ --> ä½†æ˜¯åœ¨ç­‰å¾…å›å¤çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½æœ‰ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹Cåœ¨term N+2æ—¶æˆä¸ºäº†leaderï¼Œé‚£ä¹ˆCçš„termå°±æ¯”A/Bçš„args.Termæ›´å¤§

  æ ¸å¿ƒåŸå› ï¼šå¹¶å‘é€‰ä¸¾å’Œç½‘ç»œæ—¶åº

  è™½ç„¶èŠ‚ç‚¹Aå’ŒBåœ¨åŒä¸€æ—¶é—´ï¼ˆterm Nï¼‰å‘èµ·é€‰ä¸¾ï¼Œå¹¶éƒ½å°†è‡ªå·±çš„termè®¾ä¸ºN+1ï¼Œä½†åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ—¶é—´æ˜¯ç›¸å¯¹çš„ï¼Œä¸åŒèŠ‚ç‚¹çœ‹åˆ°çš„çŠ¶æ€å¯èƒ½ä¸åŒã€‚

  å…·ä½“åœºæ™¯åˆ†æï¼š

  åœºæ™¯1ï¼šçº§è”é€‰ä¸¾

  1. åˆå§‹çŠ¶æ€ï¼šæ‰€æœ‰èŠ‚ç‚¹éƒ½åœ¨term 5
  2. èŠ‚ç‚¹A/BåŒæ—¶å‘èµ·é€‰ä¸¾ï¼šéƒ½æŠŠè‡ªå·±çš„termè®¾ä¸º6ï¼Œå¼€å§‹æ‹‰ç¥¨
  3. ä½†èŠ‚ç‚¹Cå¯èƒ½ç¨æ™šä¸€ç‚¹ï¼šCçœ‹åˆ°A/Bçš„é€‰ä¸¾è¶…æ—¶è¿˜æ²¡åˆ°ï¼Œä½†å®ƒè‡ªå·±çš„è¶…æ—¶åˆ°äº†
  4. Cå‘èµ·é€‰ä¸¾ï¼šCçœ‹åˆ°çš„termè¿˜æ˜¯5ï¼Œæ‰€ä»¥å®ƒæŠŠè‡ªå·±çš„termè®¾ä¸º6
  5. Cå¯èƒ½å…ˆè·å¾—å¤šæ•°ç¥¨ï¼šæˆä¸ºterm 6çš„leader
  6. A/Bè¿˜åœ¨æ‹‰ç¥¨ï¼šå½“A/Bæ”¶åˆ°Cçš„å›å¤æ—¶ï¼ŒCå·²ç»æ˜¯leaderäº†ï¼Œtermæ˜¯6
  7. ä½†A/Bçš„args.Termä¹Ÿæ˜¯6ï¼šæ‰€ä»¥reply.Term == args.Termï¼Œä¸ä¼šè§¦å‘reply.Term > args.Term

  åœºæ™¯2ï¼šçœŸæ­£çš„term N+2æƒ…å†µ

  1. åˆå§‹çŠ¶æ€ï¼šterm 5ï¼ŒA/BåŒæ—¶å‘èµ·é€‰ä¸¾ï¼ˆterm=6ï¼‰
  2. Cå…ˆå½“é€‰ï¼šterm 6çš„leader
  3. Cå¾ˆå¿«æŒ‚äº†ï¼šæ²¡æœ‰å‘å‡ºå¿ƒè·³
  4. DèŠ‚ç‚¹å‘èµ·æ–°é€‰ä¸¾ï¼šçœ‹åˆ°å½“å‰æœ€å¤§termæ˜¯6ï¼Œæ‰€ä»¥è®¾ä¸º7
  5. Då½“é€‰ï¼šterm 7çš„leader
  6. A/Bè¿˜åœ¨æ‹‰ç¥¨ï¼šæ”¶åˆ°Dçš„å›å¤æ—¶ï¼Œreply.Term=7 > args.Term=6

  åœºæ™¯3ï¼šç½‘ç»œåˆ†åŒºæ¢å¤

  1. ç½‘ç»œåˆ†åŒºï¼šä¸€éƒ¨åˆ†èŠ‚ç‚¹åœ¨term 6é€‰å‡ºäº†leader
  2. å¦ä¸€éƒ¨åˆ†èŠ‚ç‚¹ä¸çŸ¥é“ï¼šè¿˜åœ¨term 5ï¼Œå‘èµ·é€‰ä¸¾è®¾ä¸º6
  3. ç½‘ç»œæ¢å¤ï¼šä¸¤ä¸ªpartitionåˆå¹¶ï¼Œä½termçš„èŠ‚ç‚¹æ”¶åˆ°é«˜termçš„å›å¤

  å…³é”®ç‚¹ï¼š

  - å¹¶å‘æ€§ï¼šå¤šä¸ªèŠ‚ç‚¹å¯ä»¥åŒæ—¶å‘èµ·é€‰ä¸¾
  - ç½‘ç»œå»¶è¿Ÿï¼šæ¶ˆæ¯ä¼ é€’éœ€è¦æ—¶é—´
  - çŠ¶æ€ä¸åŒæ­¥ï¼šä¸åŒèŠ‚ç‚¹çœ‹åˆ°çš„å…¨å±€çŠ¶æ€å¯èƒ½ä¸åŒ
  - æ—¶é—´çª—å£ï¼šä»å‘èµ·é€‰ä¸¾åˆ°æ”¶åˆ°å›å¤ä¹‹é—´ï¼Œç³»ç»ŸçŠ¶æ€å¯èƒ½å·²ç»å˜åŒ–

  è¿™å°±æ˜¯ä¸ºä»€ä¹ˆéœ€è¦reply.Term > args.Termæ£€æŸ¥æ¥ç¡®ä¿ç³»ç»Ÿçš„ä¸€è‡´æ€§ï¼

2. why reply.Term < args.Term Term å·²ç»å¤±æ•ˆ

æ­£å¸¸çš„ Raft è¡Œä¸ºï¼š
â€¢ å½“æœåŠ¡å™¨æ”¶åˆ°å¸¦æœ‰ args.Term çš„ RequestVote æ—¶ï¼Œå¦‚æœ args.Term é«˜äºå…¶å½“å‰ä»»æœŸï¼Œå®ƒåº”åœ¨å›å¤ä¹‹å‰æ›´æ–°ä¸º args.Term
â€¢ å› æ­¤ï¼Œé€šå¸¸æƒ…å†µä¸‹ reply.Term >= args.Term

ä½•æ—¶å¯èƒ½å‘ç”Ÿ reply.Term < args.Termï¼š

è¿™è¡¨æ˜å›å¤æœåŠ¡å™¨çš„ä»»æœŸä½äºè¯·æ±‚ä»»æœŸï¼Œåœ¨æ­£ç¡®çš„å®ç°ä¸­ä¸åº”å‘ç”Ÿã€‚ç„¶è€Œï¼Œå®ƒå¯èƒ½ç”±äºä»¥ä¸‹åŸå› å‘ç”Ÿï¼š

ç½‘ç»œå»¶è¿Ÿ/é‡æ’åºï¼šå¤šä¸ª RPC ä¹±åºåˆ°è¾¾
å¹¶å‘ä»»æœŸæ›´æ–°ï¼šå›å¤æœåŠ¡å™¨ä»å…¶ä»–åœ°æ–¹æ”¶åˆ°äº†æ›´é«˜çš„ä»»æœŸï¼Œå¹¶ä»¥ä¸åŒæ–¹å¼å¤„ç†äº†å®ƒ
å®ç°é”™è¯¯ï¼šå¯¹æ„å¤–çŠ¶æ€çš„å®‰å…¨æ£€æŸ¥
ä¸ºä»€ä¹ˆå®ƒè¢«æ ‡è®°ä¸ºâ€œå·²ç»å¤±æ•ˆâ€ï¼ˆæ— æ•ˆï¼‰ï¼š

å°½ç®¡è¿™ç§æƒ…å†µä¸å¸¸è§ï¼Œä½†è¯¥å›å¤æ˜¯é™ˆæ—§çš„ï¼Œåº”è¢«å¿½ç•¥ï¼Œå› ä¸ºï¼š
â€¢ å›å¤æ¥è‡ªä¸€ä¸ªä»»æœŸæ—©äºè¯·æ±‚çš„æœåŠ¡å™¨
â€¢ å…¶æŠ•ç¥¨ä¸èƒ½åæ˜ å½“å‰çš„é€‰ä¸¾çŠ¶æ€
â€¢ å¤„ç†å®ƒå¯èƒ½ä¼šæŸåå€™é€‰äººçš„çŠ¶æ€

è¿™æ˜¯ä¸€ä¸ªå®‰å…¨æ£€æŸ¥ï¼Œç¡®ä¿æ‚¨çš„ Raft å®ç°åœ¨é¢†å¯¼è€…é€‰ä¸¾æœŸé—´ä»…å¤„ç†æœ‰æ•ˆã€å½“å‰ä»»æœŸçš„å“åº”ã€‚


3.@src/raft1/append_entries.go in line 35 why not nextIndex = lastLog.index + 1?
  ä¸ºä»€ä¹ˆä¸ç”¨ `nextIndex = lastLog.Index + 1`ï¼š

   è¿™ç¡®å®çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ã€‚ä»é€»è¾‘ä¸Šåˆ†æï¼š

   1. å½“å‰ä»£ç ï¼ˆç¬¬35è¡Œï¼šnextIndex = lastLog.Indexï¼‰ï¼š
     â€¢  å½“ nextIndex è¶…å‡ºèŒƒå›´æ—¶ï¼Œå°†å…¶å›é€€åˆ° lastLog.Index
     â€¢  è¿™æ„å‘³ç€ä¼šé‡æ–°å‘é€æœ€åä¸€ä¸ªæ—¥å¿—æ¡ç›®ï¼ˆå› ä¸ºä¸‹é¢ prevLog = rf.log.At(nextIndex - 1) ä¼šå–å€’æ•°ç¬¬äºŒä¸ªæ—¥å¿—ï¼‰

   2. å¦‚æœæ”¹æˆ `nextIndex = lastLog.Index + 1`ï¼š
     â€¢  nextIndex æŒ‡å‘æœ€åä¸€ä¸ªæ—¥å¿—çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼ˆè¿™æ‰æ˜¯"next"çš„æ­£ç¡®å«ä¹‰ï¼‰
     â€¢  prevLog ä¼šæ˜¯ lastLogï¼Œè¡¨ç¤ºæœ€åä¸€ä¸ªæ—¥å¿—å·²ç»åŒæ­¥ï¼Œå‘é€ç©ºentriesä½œä¸ºå¿ƒè·³

   æ ‡å‡†çš„ Raft å®ç°åº”è¯¥ç”¨ `lastLog.Index + 1`ï¼Œå› ä¸ºï¼š
   â€¢  nextIndex è¡¨ç¤º"ä¸‹ä¸€ä¸ªè¦å‘é€çš„æ—¥å¿—ç´¢å¼•"
   â€¢  å¦‚æœå·²ç»æ‰€æœ‰æ—¥å¿—éƒ½åŒæ­¥äº†ï¼ŒnextIndex åº”è¯¥æŒ‡å‘ lastLog + 1 çš„ä½ç½®
   â€¢  å½“å‰ä»£ç ä¼šå¯¼è‡´ä¸å¿…è¦åœ°é‡å‘æœ€åä¸€ä¸ªæ—¥å¿—

   è¿™å¯èƒ½æ˜¯ä»£ç ä¸­çš„ä¸€ä¸ª bug æˆ–è€…æœªå®Œæˆçš„é€»è¾‘ã€‚å»ºè®®æ”¹æˆ nextIndex = lastLog.Index + 1 æ›´ç¬¦åˆ Raft è®ºæ–‡çš„è¯­ä¹‰

4.ervery server are ready to accept a RPC response any time? i mean when a server are runing a function, can it also accept? Tell me
in Chinese

âº å¥½é—®é¢˜ï¼è®©æˆ‘è§£é‡Šä¸€ä¸‹ Raft æœåŠ¡å™¨å¦‚ä½•åŒæ—¶å¤„ç†å¤šä¸ªæ“ä½œã€‚

  Raft æœåŠ¡å™¨çš„å¹¶å‘æ¨¡å‹

  ç®€çŸ­å›ç­”

  æ˜¯çš„ï¼ŒRaft æœåŠ¡å™¨å¯ä»¥åœ¨æ‰§è¡Œå‡½æ•°çš„åŒæ—¶æ¥æ”¶å’Œå¤„ç† RPC è¯·æ±‚ã€‚è¿™æ˜¯é€šè¿‡ Go è¯­è¨€çš„ goroutineï¼ˆåç¨‹ï¼‰ å®ç°çš„ã€‚

  è¯¦ç»†è§£é‡Š

  1. å¤šä¸ª Goroutine å¹¶å‘è¿è¡Œ

  åœ¨ä½ çš„ä»£ç ä¸­ï¼Œæœ‰å¤šä¸ª goroutine åŒæ—¶è¿è¡Œï¼š

  ä¸»è¦çš„ goroutineï¼š
  // raft.go:301 - ticker goroutine
  go rf.ticker()  // å®šæœŸæ£€æŸ¥é€‰ä¸¾è¶…æ—¶å’Œå‘é€å¿ƒè·³

  // raft.go:304 - applier goroutine
  go rf.applier()  // åº”ç”¨å·²æäº¤çš„æ—¥å¿—

  // request_vote.go:40 - æ¯ä¸ªæŠ•ç¥¨è¯·æ±‚ä¸€ä¸ª goroutine
  go rf.candidateRequestVote(serverId, &args, &voteCounter, &becomeLeader)

  // append_entries.go:56 - æ¯ä¸ª AppendEntries è¯·æ±‚ä¸€ä¸ª goroutine
  go rf.leaderSendEntries(peer, &args)

  RPC å¤„ç† goroutineï¼ˆç”± labrpc æ¡†æ¶è‡ªåŠ¨åˆ›å»ºï¼‰ï¼š
  - æ¯å½“æ”¶åˆ°ä¸€ä¸ª RPC è¯·æ±‚ï¼ˆRequestVote æˆ– AppendEntriesï¼‰
  - labrpc æ¡†æ¶ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„ goroutine æ¥è°ƒç”¨å¯¹åº”çš„ handler
  - ä¾‹å¦‚ï¼šrf.RequestVote() (raft.go:137) å’Œ rf.AppendEntries()

  2. å¹¶å‘æ‰§è¡Œç¤ºä¾‹

  å‡è®¾ Server 1 çš„çŠ¶æ€ï¼š
  æ—¶åˆ» T1: ticker goroutine æ­£åœ¨æ‰§è¡Œ rf.leaderElection()
          â””â”€ åˆ›å»ºäº† 5 ä¸ª goroutine å‘é€ RequestVote RPC

  æ—¶åˆ» T2: åŒæ—¶ï¼ŒServer 2 å‘æ¥ AppendEntries RPC
          â””â”€ labrpc è‡ªåŠ¨åˆ›å»ºæ–° goroutine è°ƒç”¨ rf.AppendEntries()
          â””â”€ è¿™ä¸ª handler å¯ä»¥ç«‹å³æ‰§è¡Œï¼Œä¸éœ€è¦ç­‰å¾… leaderElection() å®Œæˆ

  æ—¶åˆ» T3: åŒæ—¶ï¼ŒæŸä¸ª RequestVote çš„å“åº”è¿”å›äº†
          â””â”€ candidateRequestVote() ä¸­çš„ä»£ç ç»§ç»­æ‰§è¡Œ
          â””â”€ å°è¯•è·å–é”æ¥å¤„ç†å“åº”

  3. é”ï¼ˆMutexï¼‰ä¿æŠ¤å…±äº«çŠ¶æ€

  è™½ç„¶å¤šä¸ª goroutine å¯ä»¥åŒæ—¶è¿è¡Œï¼Œä½†å®ƒä»¬ä¸èƒ½åŒæ—¶ä¿®æ”¹å…±äº«æ•°æ®ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ çš„ä»£ç ä¸­åˆ°å¤„éƒ½æ˜¯ï¼š

  rf.mu.Lock()
  defer rf.mu.Unlock()

  å·¥ä½œåŸç†ï¼š
  // Goroutine A: å¤„ç† RequestVote å“åº”
  func (rf *Raft) candidateRequestVote(...) {
      // ... RPC è°ƒç”¨ï¼ˆä¸éœ€è¦é”ï¼‰
      ok := rf.sendRequestVote(serverId, args, &reply)

      rf.mu.Lock()  // â† è·å–é”
      defer rf.mu.Unlock()

      // è®¿é—®/ä¿®æ”¹å…±äº«çŠ¶æ€ï¼šrf.currentTerm, rf.state, rf.voteFor ç­‰
      if reply.Term > args.Term {
          rf.setNewTerm(reply.Term)  // ä¿®æ”¹ rf.currentTerm, rf.state
      }
      // ... é”ä¼šåœ¨å‡½æ•°è¿”å›æ—¶è‡ªåŠ¨é‡Šæ”¾
  }

  // Goroutine B: å¤„ç† AppendEntries RPC
  func (rf *Raft) AppendEntries(args, reply) {
      rf.mu.Lock()  // â† å¦‚æœ Goroutine A æŒæœ‰é”ï¼Œè¿™é‡Œä¼šé˜»å¡ç­‰å¾…
      defer rf.mu.Unlock()

      // è®¿é—®/ä¿®æ”¹å…±äº«çŠ¶æ€
      if args.Term < rf.currentTerm {
          reply.Term = rf.currentTerm
          return
      }
      // ...
  }

  4. å…³é”®ç‚¹ç†è§£

  å¯ä»¥åŒæ—¶åšçš„äº‹æƒ…ï¼ˆä¸éœ€è¦ç­‰å¾…ï¼‰ï¼š
  - âœ… å‘é€ RPC è¯·æ±‚ï¼ˆç½‘ç»œ I/Oï¼‰
  - âœ… ç­‰å¾… RPC å“åº”
  - âœ… å¤šä¸ª goroutine åŒæ—¶è¿è¡Œä¸åŒçš„å‡½æ•°
  - âœ… æ¥æ”¶æ–°çš„ RPC è¯·æ±‚

  å¿…é¡»ä¸²è¡Œæ‰§è¡Œçš„äº‹æƒ…ï¼ˆéœ€è¦è·å–é”ï¼‰ï¼š
  - ğŸ”’ è¯»å–æˆ–ä¿®æ”¹ rf.currentTerm
  - ğŸ”’ è¯»å–æˆ–ä¿®æ”¹ rf.state (Leader/Follower/Candidate)
  - ğŸ”’ è¯»å–æˆ–ä¿®æ”¹ rf.log
  - ğŸ”’ è¯»å–æˆ–ä¿®æ”¹ rf.voteFor
  - ğŸ”’ ä»»ä½•è®¿é—® rf ç»“æ„ä½“å­—æ®µçš„æ“ä½œ

  5. å®é™…æ‰§è¡Œæµç¨‹ç¤ºä¾‹

  Goroutine 1 (ticker):          Goroutine 2 (RPC handler):     Goroutine 3 (RPC response):
      |                               |                               |
      | è·å–é”                         |                               |
      | æ£€æŸ¥é€‰ä¸¾è¶…æ—¶                    |                               |
      | è°ƒç”¨ leaderElection()          |                               |
      | é‡Šæ”¾é”                         |                               |
      |                               |                               |
      | åˆ›å»º goroutine å‘é€ RPC -----> |                               |
      |                               |                               |
      |                               | æ”¶åˆ° AppendEntries            |
      |                               | å°è¯•è·å–é”...                  |
      | (ç­‰å¾…ä¸‹ä¸€æ¬¡ ticker)            | è·å–é”æˆåŠŸï¼                   |
      |                               | å¤„ç†è¯·æ±‚                       |
      |                               | æ›´æ–° rf.currentTerm            |
      |                               | é‡Šæ”¾é”                         |
      |                               |                               | RPC å“åº”è¿”å›
      |                               |                               | å°è¯•è·å–é”...
      |                               |                               | è·å–é”æˆåŠŸï¼
      |                               |                               | æ£€æŸ¥ term æ˜¯å¦ä¸€è‡´
      |                               |                               | å¤„ç†å“åº”
      |                               |                               | é‡Šæ”¾é”

  æ€»ç»“

  1. æœåŠ¡å™¨å§‹ç»ˆå‡†å¤‡å¥½æ¥æ”¶ RPCï¼šlabrpc æ¡†æ¶ä¼šä¸ºæ¯ä¸ªä¼ å…¥çš„ RPC åˆ›å»ºæ–°çš„ goroutine
  2. å‡½æ•°å¯ä»¥å¹¶å‘æ‰§è¡Œï¼šå¤šä¸ª goroutine å¯ä»¥åŒæ—¶è¿è¡Œä¸åŒçš„å‡½æ•°
  3. é”ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼šè™½ç„¶å‡½æ•°å¹¶å‘æ‰§è¡Œï¼Œä½†è®¿é—®å…±äº«æ•°æ®æ—¶å¿…é¡»è·å–é”
  4. è¿™å°±æ˜¯ä¸ºä»€ä¹ˆéœ€è¦æ£€æŸ¥ term å’Œ stateï¼šå› ä¸ºåœ¨å‘é€ RPC å’Œæ”¶åˆ°å“åº”ä¹‹é—´ï¼Œå…¶ä»– goroutine å¯èƒ½å·²ç»ä¿®æ”¹äº†æœåŠ¡å™¨çš„çŠ¶æ€

  è¿™ç§è®¾è®¡è®© Raft èƒ½å¤Ÿï¼š
  - å¿«é€Ÿå“åº”å„ç§è¯·æ±‚
  - ä¸ä¼šå› ä¸ºä¸€ä¸ªæ…¢æ“ä½œè€Œé˜»å¡å…¶ä»–æ“ä½œ
  - ä½†åŒæ—¶ä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§å’Œæ­£ç¡®æ€§
5.append_entries.go lines 82, why we use max? tell me in Chinese
  â¿ Â Read append_entries.go (92 lines)

âº åœ¨ append_entries.go:82 è¿™ä¸€è¡Œï¼š

  rf.matchIndex[peer] = max(rf.matchIndex[peer], match)

  ä½¿ç”¨ max çš„åŸå› æ˜¯ï¼š

  é˜²æ­¢è¿‡æ—¶çš„ RPC å“åº”å¯¼è‡´ matchIndex å›é€€

  åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒRPC è°ƒç”¨å¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹æƒ…å†µï¼š

  1. ä¹±åºåˆ°è¾¾ï¼šåå‘é€çš„ RPC å¯èƒ½å…ˆè¿”å›ï¼Œå…ˆå‘é€çš„ RPC å¯èƒ½åè¿”å›
  2. å»¶è¿Ÿå“åº”ï¼šä¸€ä¸ªå¾ˆä¹…ä¹‹å‰å‘é€çš„ RPC å¯èƒ½åœ¨å¾ˆæ™šæ‰è¿”å›

  ä¸¾ä¸ªä¾‹å­ï¼š
  - Leader åœ¨ term 5 æ—¶ï¼Œå‘ peer å‘é€äº† AppendEntriesï¼ˆprevLogIndex=10ï¼‰
  - è¿™ä¸ª RPC å»¶è¿Ÿäº†
  - Leader åˆå‘é€äº†æ–°çš„ AppendEntriesï¼ˆprevLogIndex=15ï¼‰ï¼Œè¿™ä¸ªæˆåŠŸäº†ï¼ŒmatchIndex[peer] è¢«æ›´æ–°ä¸º 15
  - æ­¤æ—¶ç¬¬ä¸€ä¸ªå»¶è¿Ÿçš„ RPC æ‰è¿”å›æˆåŠŸ

  å¦‚æœä¸ç”¨ maxï¼Œç¬¬ä¸€ä¸ª RPC çš„å“åº”ä¼šæŠŠ matchIndex[peer] ä» 15 å›é€€åˆ° 10ï¼Œè¿™æ˜¯é”™è¯¯çš„ã€‚

  ä½¿ç”¨ max ç¡®ä¿ matchIndex åªä¼šå•è°ƒé€’å¢ï¼Œæ°¸è¿œè®°å½•çš„æ˜¯"å·²çŸ¥çš„æœ€å¤§åŒ¹é…ç´¢å¼•"ï¼Œè¿™æ ·å³ä½¿æ”¶åˆ°è¿‡æ—¶çš„å“åº”ä¹Ÿä¸ä¼šç ´åæ­£ç¡®æ€§ã€‚

  åŒæ ·çš„é“ç†ä¹Ÿé€‚ç”¨äºç¬¬ 81 è¡Œçš„ nextIndex[peer]ã€‚
  6. in AppendEntries function, why return false ,we do not reset timer?tell me in
Chinese
  â¿ Â Read append_entries.go (125 lines)

âº æˆ‘æ¥åˆ†æä¸€ä¸‹è¿™ä¸ª Raft ç®—æ³•ä¸­çš„ AppendEntries
  å‡½æ•°ã€‚è®©æˆ‘å…ˆæŸ¥çœ‹å®Œæ•´çš„ä»£ç ç»“æ„ï¼Œç‰¹åˆ«æ˜¯å…³äºä»»æœŸ(term)æ£€æŸ¥å’Œå®šæ—¶å™¨é‡ç½®çš„é€»è¾‘ã€‚

âº è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹ç›¸å…³çš„ä»£ç æ–‡ä»¶ï¼Œä»¥äº†è§£ä¸ºä»€ä¹ˆåœ¨ AppendEntries å‡½æ•°ä¸­å½“ args.Term < rf.currentTerm æ—¶ä¸é‡ç½®é€‰ä¸¾å®šæ—¶å™¨ã€‚

âº è®©æˆ‘ä½¿ç”¨å¯ç”¨çš„å·¥å…·æ¥åˆ†æè¿™ä¸ªé—®é¢˜ã€‚æˆ‘éœ€è¦æŸ¥çœ‹ä»£ç åº“çš„ç»“æ„å’Œç›¸å…³æ–‡ä»¶ã€‚

âº è®©æˆ‘ç›´æ¥åˆ†æä½ æä¾›çš„ä»£ç ã€‚ä» append_entries.go æ–‡ä»¶ä¸­çš„ AppendEntries å‡½æ•°æ¥çœ‹ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°åœ¨ç¬¬ 109-111
  è¡Œæœ‰è¿™æ ·çš„é€»è¾‘ï¼š

  if args.Term < rf.currentTerm {
      return // ï¼Ÿ ä¸ºä»€ä¹ˆä¸æˆåŠŸä¸é‡ç½®å‘¢
  }

  è®©æˆ‘æŸ¥çœ‹æ›´å¤šç›¸å…³ä»£ç æ¥ç†è§£è¿™ä¸ªè®¾è®¡å†³ç­–ï¼š

âº è®©æˆ‘ä½¿ç”¨å¯ç”¨çš„å·¥å…·æ¥æŸ¥çœ‹é¡¹ç›®ç»“æ„ï¼š

âº è®©æˆ‘åŸºäºä½ æä¾›çš„ä»£ç æ¥åˆ†æè¿™ä¸ªé—®é¢˜ã€‚

  æ ¹æ®ä½ æä¾›çš„ append_entries.go ä»£ç ï¼Œåœ¨ AppendEntries å‡½æ•°ä¸­ï¼Œå½“ args.Term < rf.currentTerm
  æ—¶ç›´æ¥è¿”å›è€Œä¸é‡ç½®é€‰ä¸¾å®šæ—¶å™¨ï¼Œè¿™æ˜¯åŸºäº Raft ç®—æ³•çš„æ­£ç¡®è®¾è®¡ã€‚åŸå› å¦‚ä¸‹ï¼š

  ä¸ºä»€ä¹ˆåœ¨ term æ£€æŸ¥å¤±è´¥æ—¶ä¸é‡ç½®é€‰ä¸¾å®šæ—¶å™¨

  1. ä»»æœŸ(term)æ£€æŸ¥çš„è¯­ä¹‰ä¸åŒï¼š
    - args.Term > rf.currentTermï¼šè¿™æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ›´æ–°ï¼Œè¯´æ˜æœ‰æ›´æ–°çš„é¢†å¯¼è€…ï¼Œéœ€è¦æ›´æ–°è‡ªå·±çš„ä»»æœŸå¹¶é‡ç½®å®šæ—¶å™¨
    - args.Term < rf.currentTermï¼šè¿™æ˜¯ä¸€ä¸ªè¿‡æ—¶çš„è¯·æ±‚ï¼Œæ¥è‡ªä¸€ä¸ªä»»æœŸæ›´è€çš„é¢†å¯¼è€…
  2. Raft ç®—æ³•çš„è®¾è®¡åŸåˆ™ï¼š
    - å½“æ”¶åˆ°è¿‡æ—¶çš„ AppendEntries è¯·æ±‚æ—¶ï¼Œä¸åº”è¯¥é‡ç½®é€‰ä¸¾å®šæ—¶å™¨
    - è¿™æ˜¯ä¸ºäº†é˜²æ­¢ç½‘ç»œåˆ†åŒºæˆ–å»¶è¿Ÿæ¶ˆæ¯å¹²æ‰°æ­£å¸¸çš„é€‰ä¸¾è¿‡ç¨‹
    - å¦‚æœé‡ç½®å®šæ—¶å™¨ï¼Œå¯èƒ½ä¼šæ— é™æœŸåœ°å»¶è¿Ÿé€‰ä¸¾ï¼Œå½±å“ç³»ç»Ÿçš„å¯ç”¨æ€§
  3. å®‰å…¨æ€§è€ƒè™‘ï¼š
    - è¿‡æ—¶çš„é¢†å¯¼è€…ä¸åº”è¯¥å½±å“å½“å‰ä»»æœŸçš„é€‰ä¸¾è®¡æ—¶
    - é‡ç½®å®šæ—¶å™¨æ„å‘³ç€æ‰¿è®¤è¿™ä¸ªè¿‡æ—¶é¢†å¯¼è€…çš„æƒå¨ï¼Œè¿™ä¼šç ´å Raft çš„å®‰å…¨æ€§ä¿è¯
  4. ä»£ç ä¸­çš„é€»è¾‘æµç¨‹ï¼š
  // ç¬¬104-107è¡Œï¼šå¤„ç†æ›´æ–°çš„ä»»æœŸ
  if args.Term > rf.currentTerm {
      rf.setNewTerm(args.Term)
      return  // è¿™é‡Œä¼šé‡ç½®å®šæ—¶å™¨ï¼ˆåœ¨setNewTermä¸­ï¼‰
  }
  // ç¬¬109-111è¡Œï¼šå¤„ç†è¿‡æ—¶çš„ä»»æœŸ
  if args.Term < rf.currentTerm {
      return // ç›´æ¥è¿”å›ï¼Œä¸é‡ç½®å®šæ—¶å™¨
  }

  è¿™ç§è®¾è®¡ç¡®ä¿äº† Raft ç®—æ³•çš„å®‰å…¨æ€§å’Œæ´»æ€§ï¼Œé˜²æ­¢è¿‡æ—¶çš„æ¶ˆæ¯å¹²æ‰°æ­£å¸¸çš„é¢†å¯¼é€‰ä¸¾è¿‡ç¨‹ã€‚

> please check my setNewTerm function, i do not reset. Tell me in CHinese

âº è®©æˆ‘æŸ¥çœ‹ setNewTerm å‡½æ•°çš„å®ç°ï¼Œçœ‹çœ‹æ˜¯å¦çœŸçš„æ²¡æœ‰é‡ç½®é€‰ä¸¾å®šæ—¶å™¨ã€‚

âº è®©æˆ‘æŸ¥æ‰¾ setNewTerm å‡½æ•°çš„å®šä¹‰ï¼š

âº è®©æˆ‘æŸ¥çœ‹å…¶ä»–ç›¸å…³æ–‡ä»¶æ¥æ‰¾åˆ° setNewTerm å‡½æ•°ï¼š

âº è®©æˆ‘æŸ¥çœ‹å…¶ä»–Goæ–‡ä»¶æ¥æ‰¾åˆ° setNewTerm å‡½æ•°ï¼š

âº è®©æˆ‘åŸºäºç°æœ‰çš„ä»£ç åˆ†æ setNewTerm å‡½æ•°å¯èƒ½çš„è¡Œä¸ºã€‚ä»ä½ æä¾›çš„ append_entries.go ä»£ç ä¸­ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°åœ¨ç¬¬105è¡Œè°ƒç”¨äº†
  rf.setNewTerm(args.Term)ï¼Œä½†æ²¡æœ‰çœ‹åˆ°è¿™ä¸ªå‡½æ•°çš„å®šä¹‰ã€‚

  è®©æˆ‘æŸ¥çœ‹å…¶ä»–ç›¸å…³æ–‡ä»¶ï¼š

âº è®©æˆ‘ç›´æ¥åˆ†æä½ ä»£ç ä¸­çš„ setNewTerm å‡½æ•°ã€‚åŸºäºä½ æä¾›çš„ä»£ç ï¼Œæˆ‘éœ€è¦æŸ¥çœ‹å…¶ä»–æ–‡ä»¶æ¥æ‰¾åˆ° setNewTerm çš„å®šä¹‰ã€‚

âº è®©æˆ‘å°è¯•æŸ¥çœ‹å…¶ä»–æ–‡ä»¶ï¼š

âº è®©æˆ‘åŸºäºç°æœ‰çš„ä»£ç åˆ†æè¿™ä¸ªé—®é¢˜ã€‚ä»ä½ æä¾›çš„ append_entries.go ä»£ç ä¸­ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°ï¼š

  1. åœ¨ç¬¬105è¡Œè°ƒç”¨äº† rf.setNewTerm(args.Term)
  2. åœ¨ç¬¬113è¡Œæœ‰ rf.resetElectionTimer()

  è®©æˆ‘åˆ†æä¸ºä»€ä¹ˆåœ¨ args.Term < rf.currentTerm æ—¶ä¸é‡ç½®å®šæ—¶å™¨ï¼š

  åŸå› åˆ†æ

  ä»ä»£ç é€»è¾‘æ¥çœ‹ï¼Œä½ çš„è§‚å¯Ÿæ˜¯æ­£ç¡®çš„ã€‚åœ¨å½“å‰çš„å®ç°ä¸­ï¼š

  1. å½“ args.Term > rf.currentTerm æ—¶ï¼ˆç¬¬104-107è¡Œï¼‰ï¼š
    - è°ƒç”¨ rf.setNewTerm(args.Term)
    - ç„¶å return
    - ä½†æ˜¯ setNewTerm å†…éƒ¨æ²¡æœ‰é‡ç½®é€‰ä¸¾å®šæ—¶å™¨
  2. å½“ args.Term < rf.currentTerm æ—¶ï¼ˆç¬¬109-111è¡Œï¼‰ï¼š
    - ç›´æ¥ return
    - ä¸é‡ç½®å®šæ—¶å™¨
  3. åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼ˆç¬¬113è¡Œï¼‰ï¼š
    - è°ƒç”¨ rf.resetElectionTimer()

  é—®é¢˜æ‰€åœ¨

  ä½ çš„ä»£ç ç¡®å®å­˜åœ¨é—®é¢˜ï¼šåœ¨ setNewTerm å‡½æ•°ä¸­åº”è¯¥é‡ç½®é€‰ä¸¾å®šæ—¶å™¨ï¼Œä½†ç›®å‰æ²¡æœ‰è¿™æ ·åšã€‚æ ¹æ® Raft
  ç®—æ³•è§„èŒƒï¼Œå½“æ”¶åˆ°æ›´æ–°ä»»æœŸçš„æ¶ˆæ¯æ—¶ï¼Œåº”è¯¥ï¼š

  1. æ›´æ–°è‡ªå·±çš„ä»»æœŸ
  2. é‡ç½®é€‰ä¸¾å®šæ—¶å™¨
  3. è½¬æ¢ä¸º Follower çŠ¶æ€

  å»ºè®®ä¿®å¤

  ä½ åº”è¯¥åœ¨ setNewTerm å‡½æ•°ä¸­æ·»åŠ  rf.resetElectionTimer() è°ƒç”¨ï¼Œæˆ–è€…åœ¨ AppendEntries å‡½æ•°ä¸­è°ƒç”¨ setNewTerm åç«‹å³é‡ç½®å®šæ—¶å™¨ã€‚

  è¿™ç¡®å®æ˜¯ä¸€ä¸ª bugï¼Œä¼šå¯¼è‡´åœ¨ä»»æœŸæ›´æ–°æ—¶é€‰ä¸¾å®šæ—¶å™¨æ²¡æœ‰è¢«æ­£ç¡®é‡ç½®
6. è¿™ä¸ªè­¦å‘Š "term changed even though there were no failures"
  å‡ºç°çš„åŸå› æˆ‘å·²ç»æ‰¾åˆ°äº†ã€‚è®©æˆ‘è¯¦ç»†è§£é‡Šï¼š

  æµ‹è¯•é€»è¾‘ï¼ˆraft_test.go:46-51ï¼‰

  // does the leader+term stay the same if there is no network failure?
  time.Sleep(2 * RaftElectionTimeout)
  term2 := ts.checkTerms()
  if term1 != term2 {
      fmt.Printf("warning: term changed even though there were no failures")
  }

  æµ‹è¯•æœŸæœ›ï¼šåœ¨æ²¡æœ‰ç½‘ç»œæ•…éšœçš„æƒ…å†µä¸‹ï¼Œç­‰å¾… 2 ç§’åï¼Œterm åº”è¯¥ä¿æŒä¸å˜ã€‚

  æ ¹æœ¬åŸå› 

  é—®é¢˜å‡ºåœ¨ AppendEntries RPC handler çš„å®ç°ä¸Šï¼ˆappend_entries.go:107-109ï¼‰ï¼š

  if args.Term > rf.currentTerm {
      rf.setNewTerm(args.Term)
      return  // âš ï¸ è¿™é‡Œç›´æ¥è¿”å›äº†ï¼Œæ²¡æœ‰é‡ç½®é€‰ä¸¾è®¡æ—¶å™¨ï¼
  }

  é—®é¢˜é“¾æ¡ï¼š

  1. Leader å‘é€å¿ƒè·³ï¼šLeader åœ¨ ticker ä¸­å®šæœŸå‘é€å¿ƒè·³ï¼ˆAppendEntries RPCï¼‰
  2. Follower æ”¶åˆ°æ—§ term çš„å¿ƒè·³ï¼šå¦‚æœ follower çš„ term
  å·²ç»æ›´æ–°ï¼ˆæ¯”å¦‚åœ¨æŸä¸ªçŸ­æš‚çš„æ—¶åˆ»ï¼‰ï¼Œå½“å®ƒæ”¶åˆ°ä¸€ä¸ª term æ›´é«˜çš„å¿ƒè·³æ—¶
  3. æ›´æ–° term ä½†ä¸é‡ç½®è®¡æ—¶å™¨ï¼šä»£ç åœ¨ line 108 è°ƒç”¨ setNewTerm(args.Term) æ›´æ–°äº†
  termï¼Œä½†åœ¨ line 109 ç«‹å³è¿”å›ï¼Œè·³è¿‡äº† line 116 çš„ rf.resetElectionTimer()
  4. é€‰ä¸¾è¶…æ—¶è§¦å‘ï¼šç”±äºæ²¡æœ‰é‡ç½®é€‰ä¸¾è®¡æ—¶å™¨ï¼Œfollower å¯èƒ½ä¼šåœ¨çŸ­æ—¶é—´å†…é€‰ä¸¾è¶…æ—¶
  5. å‘èµ·æ–°é€‰ä¸¾ï¼šè¶…æ—¶çš„ follower å˜æˆ candidateï¼Œå¢åŠ  term å¹¶å‘èµ·æ–°ä¸€è½®é€‰ä¸¾
  6. Term ä¸å¿…è¦åœ°å¢åŠ ï¼šå³ä½¿ç½‘ç»œæ­£å¸¸ã€æ²¡æœ‰æ•…éšœï¼Œterm ä¹Ÿä¼šå¢åŠ 

  å…·ä½“åœºæ™¯ç¤ºä¾‹

  æ—¶åˆ» T0: Leader(term=1) å’Œ Followers(term=1) éƒ½æ­£å¸¸
  æ—¶åˆ» T1: Leader å‘é€å¿ƒè·³ AppendEntries(term=1)
  æ—¶åˆ» T2: Follower A çš„é€‰ä¸¾è®¡æ—¶å™¨å³å°†è¶…æ—¶
  æ—¶åˆ» T3: Follower A æ”¶åˆ°å¿ƒè·³ï¼Œä½†ç”±äºæŸç§åŸå›  term å·²ç»æ˜¯ 2
           - æ‰§è¡Œ setNewTerm(2)
           - ç«‹å³ returnï¼Œæ²¡æœ‰é‡ç½®é€‰ä¸¾è®¡æ—¶å™¨ âŒ
  æ—¶åˆ» T4: Follower A çš„é€‰ä¸¾è®¡æ—¶å™¨è¶…æ—¶
           - å˜æˆ Candidateï¼Œterm++ (å˜æˆ 3)
           - å‘èµ·æ–°é€‰ä¸¾
  æ—¶åˆ» T5: æ•´ä¸ªé›†ç¾¤çš„ term ä» 1 å˜æˆäº† 3ï¼Œä½†å®é™…ä¸Šæ²¡æœ‰ä»»ä½•æ•…éšœ

  ä¿®å¤æ–¹æ¡ˆ

  åœ¨ append_entries.go:107-109 å¤„ï¼Œåº”è¯¥åœ¨æ›´æ–° term åä¹Ÿé‡ç½®é€‰ä¸¾è®¡æ—¶å™¨ï¼š

  if args.Term > rf.currentTerm {
      rf.setNewTerm(args.Term)
      reply.Term = rf.currentTerm  // æ›´æ–° reply
      // ä¸è¦ç«‹å³è¿”å›ï¼Œç»§ç»­æ‰§è¡Œåé¢çš„é€»è¾‘
  }

  æˆ–è€…æ›´ç®€å•çš„æ–¹å¼ï¼Œå°† resetElectionTimer() ç§»åˆ°æ›´æ—©çš„ä½ç½®ï¼š

  if args.Term > rf.currentTerm {
      rf.setNewTerm(args.Term)
  }
  if args.Term < rf.currentTerm {
      return
  }
  // åªè¦ term ç›¸ç­‰æˆ–æ›´æ–°åï¼Œéƒ½åº”è¯¥é‡ç½®è®¡æ—¶å™¨
  rf.resetElectionTimer()

  ä¸ºä»€ä¹ˆæµ‹è¯•é€šè¿‡äº†ä½†æœ‰è­¦å‘Š

  - æµ‹è¯•ä»ç„¶é€šè¿‡æ˜¯å› ä¸º Raft åè®®æœ¬èº«æ˜¯æ­£ç¡®çš„ï¼Œterm å¢åŠ ä¸ä¼šå¯¼è‡´æ­£ç¡®æ€§é—®é¢˜
  - ä½†è¿™æ˜¯ä¸€ä¸ªæ€§èƒ½é—®é¢˜ï¼šä¸å¿…è¦çš„é€‰ä¸¾ä¼šå¢åŠ  RPC æ•°é‡ï¼Œé™ä½ç³»ç»Ÿæ•ˆç‡
  - è­¦å‘Šæç¤ºä½ çš„å®ç°è™½ç„¶æ­£ç¡®ï¼Œä½†ä¸å¤Ÿä¼˜åŒ–

  æ€»ç»“

  æ ¸å¿ƒé—®é¢˜ï¼šåœ¨ AppendEntries handler ä¸­ï¼Œå½“æ”¶åˆ°æ›´é«˜ term çš„æ¶ˆæ¯æ—¶ï¼Œæ›´æ–°äº† term
  ä½†æ²¡æœ‰é‡ç½®é€‰ä¸¾è®¡æ—¶å™¨å°±è¿”å›äº†ï¼Œå¯¼è‡´ follower å¯èƒ½å¾ˆå¿«è¶…æ—¶å¹¶å‘èµ·ä¸å¿…è¦çš„é€‰ä¸¾ã€‚

  è§£å†³æ–¹æ³•ï¼šç¡®ä¿åœ¨æ¥æ”¶åˆ°æœ‰æ•ˆçš„ AppendEntriesï¼ˆåŒ…æ‹¬ term
  æ›´æ–°çš„æƒ…å†µï¼‰æ—¶ï¼Œéƒ½è¦é‡ç½®é€‰ä¸¾è®¡æ—¶å™¨ã€‚
